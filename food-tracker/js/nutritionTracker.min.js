/**! Food Tracker App
 * @namespace {object} nt */
var nt={Models:{},Collections:{},Views:{},Router:{},Plugin:{},Option:{},preloader:'<div class="spinnerContainer">Loading <div class="spinner"></div> Please Wait'};Handlebars.registerPartial("servings-partial",Handlebars.template({1:function(t,e,a,n,i){var r;return" Ã— "+t.escapeExpression((r=null!=(r=a.servingCount||(null!=e?e.servingCount:e))?r:a.helperMissing,"function"==typeof r?r.call(null!=e?e:{},{name:"servingCount",hash:{},data:i}):r))},compiler:[7,">= 4.0.0"],main:function(t,e,a,n,i){var r,s,l=null!=e?e:{},o=a.helperMissing,c="function",u=t.escapeExpression;return u((s=null!=(s=a.valueServingSize||(null!=e?e.valueServingSize:e))?s:o,typeof s===c?s.call(l,{name:"valueServingSize",hash:{},data:i}):s))+" "+u((s=null!=(s=a.valueServingSizeUnit||(null!=e?e.valueServingSizeUnit:e))?s:o,typeof s===c?s.call(l,{name:"valueServingSizeUnit",hash:{},data:i}):s))+(null!=(r=a["if"].call(l,null!=e?e.moreThanOne:e,{name:"if",hash:{},fn:t.program(1,i,0),inverse:t.noop,data:i}))?r:"")},useData:!0})),this.Handlebars=this.Handlebars||{},this.Handlebars.Templates=this.Handlebars.Templates||{},this.Handlebars.Templates.buttons=Handlebars.template({1:function(t,e,a,n,i){return'        <p><button id="nutrition-track" type="button" class="btn btn-warning btn-xs btn-block">\r\n        <i class="glyphicon glyphicon-ok-circle"></i> Tracking\r\n        </button></p>\r\n        <button id="nutrition-close" type="button" class="btn btn-primary btn-sm">\r\n        <i class="glyphicon glyphicon-arrow-left"></i> Back\r\n        </button>\r\n        <button id="nutrition-add" type="button" class="btn btn-info btn-sm">\r\n        <i class="glyphicon glyphicon-pencil"></i> Edit\r\n        </button>\r\n        <button id="nutrition-remove" type="button" class="btn btn-danger btn-sm">\r\n        <i class="glyphicon glyphicon-remove"></i> Remove\r\n        </button>\r\n'},3:function(t,e,a,n,i){return'        <p><button type="button" class="btn btn-default btn-xs btn-block" disabled>\r\n        <i class="glyphicon glyphicon-ban-circle"></i> Not Tracking\r\n        </button></p>\r\n        <button id="nutrition-close" type="button" class="btn btn-primary btn-sm">\r\n        <i class="glyphicon glyphicon-arrow-left"></i> Back\r\n        </button>\r\n        <button id="nutrition-add" type="button" class="btn btn-success btn-sm">\r\n        <i class="glyphicon glyphicon-plus"></i> Add\r\n        </button>\r\n'},compiler:[7,">= 4.0.0"],main:function(t,e,a,n,i){var r;return'    <div class="buttons">\r\n'+(null!=(r=a["if"].call(null!=e?e:{},null!=e?e.tracking:e,{name:"if",hash:{},fn:t.program(1,i,0),inverse:t.program(3,i,0),data:i}))?r:"")+"    </div>"},useData:!0}),this.Handlebars.Templates.editor=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(t,e,a,n,i){var r,s,l=null!=e?e:{},o=a.helperMissing,c="function",u=t.escapeExpression;return'    <div id="editor-top">\r\n      <h3>Food Summary</h3>\r\n      <span id="foodClose" class="glyphicon glyphicon-remove-circle"></span>\r\n    </div>\r\n    <br>\r\n    <form>\r\n      <div class="input-group date" id="dateTimePicker">\r\n        <span class="input-group-addon">Track Date</span>\r\n        <input type="text" class="form-control" id="foodTrackDate" value="'+u((s=null!=(s=a.trackDate||(null!=e?e.trackDate:e))?s:o,typeof s===c?s.call(l,{name:"trackDate",hash:{},data:i}):s))+'">\r\n        <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>\r\n      </div>\r\n      <br>\r\n      <div class="input-group">\r\n        <span class="input-group-addon">Name</span>\r\n        <input type="text" class="form-control" id="foodName" value="'+u((s=null!=(s=a.itemName||(null!=e?e.itemName:e))?s:o,typeof s===c?s.call(l,{name:"itemName",hash:{},data:i}):s))+'">\r\n      </div>\r\n      <br>\r\n      <div class="input-group">\r\n        <span class="input-group-addon calories-addon">Calories</span>\r\n        <input disabled type="text" class="form-control" id="foodCalories" value="'+u((s=null!=(s=a.valueCalories||(null!=e?e.valueCalories:e))?s:o,typeof s===c?s.call(l,{name:"valueCalories",hash:{},data:i}):s))+' kcal">\r\n      </div>\r\n      <br>\r\n      <div class="input-group">\r\n        <span class="input-group-addon fat-addon">Fat</span>\r\n        <input disabled type="text" class="form-control" id="foodFat" value="'+u((s=null!=(s=a.valueTotalFat||(null!=e?e.valueTotalFat:e))?s:o,typeof s===c?s.call(l,{name:"valueTotalFat",hash:{},data:i}):s))+' g">\r\n      </div>\r\n      <br>\r\n      <div class="input-group">\r\n        <span class="input-group-addon carbs-addon">Carbohydrates</span>\r\n        <input disabled type="text" class="form-control" id="foodCarbs" value="'+u((s=null!=(s=a.valueTotalCarb||(null!=e?e.valueTotalCarb:e))?s:o,typeof s===c?s.call(l,{name:"valueTotalCarb",hash:{},data:i}):s))+' g">\r\n      </div>\r\n      <br>\r\n      <div class="input-group">\r\n        <span class="input-group-addon protein-addon">Protein</span>\r\n        <input disabled type="text" class="form-control" id="foodProtein" value="'+u((s=null!=(s=a.valueProteins||(null!=e?e.valueProteins:e))?s:o,typeof s===c?s.call(l,{name:"valueProteins",hash:{},data:i}):s))+' g">\r\n      </div>\r\n      <br>\r\n      <div class="input-group">\r\n        <span class="input-group-addon serving-addon">Serving</span>\r\n        <input disabled type="text" class="form-control" id="foodServingSize" value="'+(null!=(r=t.invokePartial(n["servings-partial"],e,{name:"servings-partial",data:i,helpers:a,partials:n,decorators:t.decorators}))?r:"")+'">\r\n        <input type="hidden" id="foodServingCount" value="'+u((s=null!=(s=a.servingCount||(null!=e?e.servingCount:e))?s:o,typeof s===c?s.call(l,{name:"servingCount",hash:{},data:i}):s))+'">\r\n        <span class="input-group-btn">\r\n          <button id="servingIncrease" class="btn" type="button"><i class="glyphicon glyphicon-triangle-top"></i></button>\r\n          <button id="servingDecrease" class="btn" type="button"><i class="glyphicon glyphicon-triangle-bottom"></i></button>\r\n        </span>\r\n      </div>\r\n      <br>\r\n      <button id="foodSave" type="submit" class="btn btn-default btn-block">Save Food</button>\r\n    </form>'},usePartial:!0,useData:!0}),this.Handlebars.Templates.item=Handlebars.template({1:function(t,e,a,n,i){var r,s=null!=e?e:{},l=a.helperMissing,o="function",c=t.escapeExpression;return'    <div class="item">\r\n      <h4><a class="item-nutrition" href="'+c((r=null!=(r=a.id||(null!=e?e.id:e))?r:l,typeof r===o?r.call(s,{name:"id",hash:{},data:i}):r))+'" data-item="'+c((r=null!=(r=a.id||(null!=e?e.id:e))?r:l,typeof r===o?r.call(s,{name:"id",hash:{},data:i}):r))+'">'+c((r=null!=(r=a.name||(null!=e?e.name:e))?r:l,typeof r===o?r.call(s,{name:"name",hash:{},data:i}):r))+"</a></h4>\r\n      <h6>Cals: "+c((r=null!=(r=a.calories||(null!=e?e.calories:e))?r:l,typeof r===o?r.call(s,{name:"calories",hash:{},data:i}):r))+" | Fat: "+c((r=null!=(r=a.fat||(null!=e?e.fat:e))?r:l,typeof r===o?r.call(s,{name:"fat",hash:{},data:i}):r))+"g | Carbs: "+c((r=null!=(r=a.carbs||(null!=e?e.carbs:e))?r:l,typeof r===o?r.call(s,{name:"carbs",hash:{},data:i}):r))+"g | Prot: "+c((r=null!=(r=a.protein||(null!=e?e.protein:e))?r:l,typeof r===o?r.call(s,{name:"protein",hash:{},data:i}):r))+"g</h6>\r\n      <h6>Serving: "+c((r=null!=(r=a.servingSize||(null!=e?e.servingSize:e))?r:l,typeof r===o?r.call(s,{name:"servingSize",hash:{},data:i}):r))+" "+c((r=null!=(r=a.servingUnit||(null!=e?e.servingUnit:e))?r:l,typeof r===o?r.call(s,{name:"servingUnit",hash:{},data:i}):r))+"</h6>\r\n    </div>\r\n"},compiler:[7,">= 4.0.0"],main:function(t,e,a,n,i){var r;return'    <h4 id="recipe-open">\r\n      <span class="label label-info"><i class="glyphicon glyphicon-info-sign"></i> Recipe Suggestions</span>\r\n    </h4>\r\n'+(null!=(r=a.each.call(null!=e?e:{},null!=e?e.items:e,{name:"each",hash:{},fn:t.program(1,i,0),inverse:t.noop,data:i}))?r:"")+'    <footer class="logo">\r\n      <a href="http://www.nutritionix.com/api" target="_blank"><img src="images/nutritionix.png" alt="Powered By Nutritionix"></a>\r\n    </footer>'},useData:!0}),this.Handlebars.Templates.recipe=Handlebars.template({1:function(t,e,a,n,i){var r,s=null!=e?e:{},l=a.helperMissing,o="function",c=t.escapeExpression;return'    <div class="recipe-item">\r\n      <h4>'+c((r=null!=(r=a.recipeTitle||(null!=e?e.recipeTitle:e))?r:l,typeof r===o?r.call(s,{name:"recipeTitle",hash:{},data:i}):r))+'</h4>\r\n      <div class="r-container">\r\n        <div class="r-image">\r\n          <img class="thumb" src="'+c((r=null!=(r=a.recipeImage||(null!=e?e.recipeImage:e))?r:l,typeof r===o?r.call(s,{name:"recipeImage",hash:{},data:i}):r))+'" alt="'+c((r=null!=(r=a.recipeTitle||(null!=e?e.recipeTitle:e))?r:l,typeof r===o?r.call(s,{name:"recipeTitle",hash:{},data:i}):r))+'">\r\n        </div>\r\n        <div class="r-text">\r\n          <img class="icon" src="'+c((r=null!=(r=a.siteIcon||(null!=e?e.siteIcon:e))?r:l,typeof r===o?r.call(s,{name:"siteIcon",hash:{},data:i}):r))+'" alt="'+c((r=null!=(r=a.siteTitle||(null!=e?e.siteTitle:e))?r:l,typeof r===o?r.call(s,{name:"siteTitle",hash:{},data:i}):r))+'">\r\n          <a href="'+c((r=null!=(r=a.siteLink||(null!=e?e.siteLink:e))?r:l,typeof r===o?r.call(s,{name:"siteLink",hash:{},data:i}):r))+'" target="_blank">'+c((r=null!=(r=a.siteTitle||(null!=e?e.siteTitle:e))?r:l,typeof r===o?r.call(s,{name:"siteTitle",hash:{},data:i}):r))+"</a>\r\n          <h6>"+c((r=null!=(r=a.numCalories||(null!=e?e.numCalories:e))?r:l,typeof r===o?r.call(s,{name:"numCalories",hash:{},data:i}):r))+" Calories Per Serving</h6>\r\n          <h6>"+c((r=null!=(r=a.numIngredients||(null!=e?e.numIngredients:e))?r:l,typeof r===o?r.call(s,{name:"numIngredients",hash:{},data:i}):r))+" Ingredients</h6>\r\n        </div>\r\n      </div>\r\n    </div>\r\n"},compiler:[7,">= 4.0.0"],main:function(t,e,a,n,i){var r;return(null!=(r=a.each.call(null!=e?e:{},null!=e?e.recipes:e,{name:"each",hash:{},fn:t.program(1,i,0),inverse:t.noop,data:i}))?r:"")+'    <footer class="logo">\r\n      <a href="https://thinkingjet.me" target="_blank"><img src="images/footer.png" alt="Food Tracker"></a>\r\n    </footer>'},useData:!0}),this.Handlebars.Templates.search=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(t,e,a,n,i){return'  <div class="input-group">\r\n    <input id="search-food" type="search" class="form-control" placeholder="What did you eat?">\r\n    <span class="input-group-btn">\r\n      <button class="btn btn-default" type="button" id="search-clear" title="Clear">\r\n        <i class="glyphicon glyphicon-remove-circle"></i>\r\n      </button>\r\n    </span>\r\n  </div>\r\n  <ul class="dropdown-menu"></ul>'},useData:!0}),this.Handlebars.Templates.tracked=Handlebars.template({1:function(t,e,a,n,i){var r,s=null!=e?e:{},l=a.helperMissing,o=t.escapeExpression,c=t.lambda;return'        <tr class="tracked-row"'+o((a.title||e&&e.title||l).call(s,null!=(r=null!=e?e.attributes:e)?r.trackDate:r,{name:"title",hash:{},data:i}))+'>\r\n          <td class="tracked-attr"><a class="tracked-edit" href="#edit" data-item="'+o(c(null!=(r=null!=e?e.attributes:e)?r.id:r,e))+'" title="'+o(c(null!=(r=null!=e?e.attributes:e)?r.itemName:r,e))+'">'+o(c(null!=(r=null!=e?e.attributes:e)?r.itemName:r,e))+'</a></td>\r\n          <td class="tracked-attr">'+o((a.show||e&&e.show||l).call(s,null!=(r=null!=e?e.attributes:e)?r.valueCalories:r,{name:"show",hash:{},data:i}))+'</td>\r\n          <td class="tracked-attr">'+o((a.show||e&&e.show||l).call(s,null!=(r=null!=e?e.attributes:e)?r.valueTotalFat:r,{name:"show",hash:{},data:i}))+'</td>\r\n          <td class="tracked-attr">'+o((a.show||e&&e.show||l).call(s,null!=(r=null!=e?e.attributes:e)?r.valueTotalCarb:r,{name:"show",hash:{},data:i}))+'</td>\r\n          <td class="tracked-attr">'+o((a.show||e&&e.show||l).call(s,null!=(r=null!=e?e.attributes:e)?r.valueProteins:r,{name:"show",hash:{},data:i}))+'</td>\r\n          <td class="tracked-attr"><i class="tracked-delete glyphicon glyphicon-remove" data-id="'+o(c(null!=(r=null!=e?e.attributes:e)?r.id:r,e))+'" title="Delete"></i></td>\r\n        </tr>\r\n'},compiler:[7,">= 4.0.0"],main:function(t,e,a,n,i){var r,s,l=null!=e?e:{},o=a.helperMissing,c="function",u=t.escapeExpression;return'    <table class="tracked-item">\r\n      <thead>\r\n        <tr>\r\n          <th class="tracked-first">Food</th>\r\n          <th title="Calories">Cals</th>\r\n          <th>Fat</th>\r\n          <th title="Carbohydrates">Carbs</th>\r\n          <th title="Protein">Prot</th>\r\n          <th class="tracked-last"><i class="glyphicon glyphicon-remove"></i></th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n'+(null!=(r=a.each.call(l,null!=e?e.models:e,{name:"each",hash:{},fn:t.program(1,i,0),inverse:t.noop,data:i}))?r:"")+'      </tbody>\r\n      <tfoot>\r\n        <tr class="totals-row">\r\n          <td class="totals-attr">TOTALS</td>\r\n          <td class="totals-attr">'+u((s=null!=(s=a.sumCals||(null!=e?e.sumCals:e))?s:o,typeof s===c?s.call(l,{name:"sumCals",hash:{},data:i}):s))+'</td>\r\n          <td class="totals-attr">'+u((s=null!=(s=a.sumFat||(null!=e?e.sumFat:e))?s:o,typeof s===c?s.call(l,{name:"sumFat",hash:{},data:i}):s))+'</td>\r\n          <td class="totals-attr">'+u((s=null!=(s=a.sumCarbs||(null!=e?e.sumCarbs:e))?s:o,typeof s===c?s.call(l,{name:"sumCarbs",hash:{},data:i}):s))+'</td>\r\n          <td class="totals-attr" colspan="2">'+u((s=null!=(s=a.sumProt||(null!=e?e.sumProt:e))?s:o,typeof s===c?s.call(l,{name:"sumProt",hash:{},data:i}):s))+"</td>\r\n        </tr>\r\n      </tfoot>\r\n    </table>"},useData:!0}),nt.Models.Food=Backbone.Model.extend({defaults:{id:"",sortOrder:0,name:"",fat:0,carbs:0,protein:0,calories:0,servingSize:0,servingUnit:""},parse:function(t){if("undefined"!=typeof t.fields){var e={};return e.id=t._id,e.name=t.fields.item_name,e.calories=t.fields.nf_calories,e.fat=t.fields.nf_total_fat,e.carbs=t.fields.nf_total_carbohydrate,e.protein=t.fields.nf_protein,e.servingSize=t.fields.nf_serving_size_qty,e.servingUnit=t.fields.nf_serving_size_unit,e}return t}}),nt.Models.Recipe=Backbone.Model.extend({defaults:{id:"",recipeImage:"",recipeTitle:"",numCalories:"",numIngredients:"",siteIcon:"",siteTitle:"",siteLink:""},parse:function(t){var e=t.recipe.uri.indexOf("_")+1,a="http://www.edamam.com/http/",n="images/icon.png";t.recipe.sourceIcon&&(n=t.recipe.sourceIcon.replace("http://",a));var i={};return i.id=t.recipe.uri.slice(e),i.recipeImage=t.recipe.image,i.recipeTitle=t.recipe.label,i.numCalories=parseInt(t.recipe.calories/t.recipe["yield"],10),i.numIngredients=t.recipe.ingredientLines.length,i.siteIcon=n,i.siteTitle=t.recipe.source,i.siteLink=t.recipe.shareAs,i}}),nt.Models.Nutrition=Backbone.Model.extend({defaults:function(){return{width:280,id:"",itemName:"",servingCount:1,moreThanOne:!1,showPolyFat:!1,showMonoFat:!1,showIngredients:!1,valueServingSize:0,valueServingSizeUnit:"",valueCalories:0,valueFatCalories:0,valueTotalFat:0,valueSatFat:0,valueTransFat:0,valueCholesterol:0,valueSodium:0,valueTotalCarb:0,valueFibers:0,valueSugars:0,valueProteins:0,valueVitaminA:0,valueVitaminC:0,valueCalcium:0,valueIron:0}},url:"https://api.nutritionix.com/v1_1/item/",parse:function(t){if(t.hasOwnProperty("item_id")){var e={};return e.width=280,e.id=t.item_id,e.itemName=t.item_name,e.servingCount=1,e.moreThanOne=!1,e.showPolyFat=!1,e.showMonoFat=!1,e.showIngredients=!1,e.valueServingSize=t.nf_serving_size_qty,e.valueServingSizeUnit=t.nf_serving_size_unit,e.valueCalories=t.nf_calories,e.valueFatCalories=t.nf_calories_from_fat,e.valueTotalFat=t.nf_total_fat,e.valueSatFat=t.nf_saturated_fat,e.valueTransFat=t.nf_trans_fatty_acid,e.valueCholesterol=t.nf_cholesterol,e.valueSodium=t.nf_sodium,e.valueTotalCarb=t.nf_total_carbohydrate,e.valueFibers=t.nf_dietary_fiber,e.valueSugars=t.nf_sugars,e.valueProteins=t.nf_protein,e.valueVitaminA=t.nf_vitamin_a_dv,e.valueVitaminC=t.nf_vitamin_c_dv,e.valueCalcium=t.nf_calcium_dv,e.valueIron=t.nf_iron_dv,e}return t},validate:function(t,e){if(t.hasOwnProperty("trackDate")){if(""===t.trackDate)return"Date cannot be blank.";var a=moment(t.trackDate,"YYYY-MM-DD",!0).isValid();if(!a)return"Date must be in YYYY-MM-DD format."}return""===t.itemName?"Food name cannot be blank.":void 0},valueUpdate:function(t,e){var a=["valueCalories","valueFatCalories","valueTotalFat","valueSatFat","valueTransFat","valueCholesterol","valueSodium","valueTotalCarb","valueFibers","valueSugars","valueProteins","valueVitaminA","valueVitaminC","valueCalcium","valueIron"],n=_.pick(t,a),i=0,r="",s=0;for(r in n)i=n[r],i&&(s=i*e,Number.isInteger(s)?n[r]=s:n[r]=Number(s).toFixed(2));e>1?n.moreThanOne=!0:n.moreThanOne=!1,n.servingCount=e,this.set(n)}}),nt.Models.Autocomplete=Backbone.Model.extend({defaults:{id:"",text:""}}),nt.Collections.FoodSearch=Backbone.Collection.extend({model:nt.Models.Food,searchPhrase:"",url:function(){return"https://api.nutritionix.com/v1_1/search/"+this.searchPhrase},parse:function(t){return t.hits},nextOrder:function(){return this.length?this.last().get("sortOrder")+1:1},comparator:function(t){return t.get("sortOrder")}}),nt.Collections.RecipeSearch=Backbone.Collection.extend({model:nt.Models.Recipe,url:"https://api.edamam.com/search",sync:function(t,e,a){return a.dataType="jsonp",Backbone.sync(t,e,a)},parse:function(t){return t.hits}}),nt.Collections.NutritionTracker=Backbone.Collection.extend({model:nt.Models.Nutrition,localStorage:new Backbone.LocalStorage("food-tracker"),initialize:function(){nt.Option.trackerDate=moment(new Date).format("YYYY-MM-DD"),nt.Option.displayAll=!1},comparator:function(t){return t.get("trackDate")},getModelsByDate:function(){var t=this.where({trackDate:nt.Option.trackerDate}),e=new Backbone.Collection(t);return e},calculateSum:function(t){var e=this,a=0;return this.length?(nt.Option.displayAll||(e=this.getModelsByDate()),a=e.reduce(function(e,a){return Number(e)+Number(a.get(t)*a.get("servingCount"))},0),Number.isInteger(a)?a:Number(a).toFixed(2)):void 0}}),nt.Collections.AutocompleteSearch=Backbone.Collection.extend({model:nt.Models.Autocomplete,url:"https://api.nutritionix.com/v2/autocomplete",api:{q:"",appId:"53242d79",appKey:"82289438a16ec7b92cdcf5ad054159c4"},apiError:function(t,e){var a=e.status+" "+e.statusText+" : Autocomplete server request error. <br> Please try again.";window.console&&console.log(a),$("#search-suggest .dropdown-menu").show().html('<li class="typeahead-error"><a>'+a+"</a></li>")},fetch:function(){return this.trigger("fetch",this),Backbone.Model.prototype.fetch.apply(this,arguments)}}),nt.Views.Start=Backbone.View.extend({el:"#start-screen",events:{"click .btn-success":"startSearch"},showStart:function(){this.$el.show(),$("#app").hide()},hideStart:function(){this.$el.hide(),$("#app").show()},startSearch:function(){nt.Router.Instance["goto"]("search")}}),nt.Views.TabNav=Backbone.View.extend({initialize:function(){$("#app-tabs a").click(function(t){t.preventDefault(),$(this).tab("show"),$(".row").eqHeights({child:".eqHeights"})})}}),nt.Views.Search=Backbone.View.extend({el:"#search-top",itemTemplate:Handlebars.Templates.item,events:{"click #search-help":"toggleHelp","click #search-help-text .close":"toggleHelp","click #search-clear":"clearSearch","submit #search-suggest":"noSubmit"},initialize:function(){_.bindAll(this,"searchSuccess","searchError"),this.$searchTop=$("#search-top"),this.$searchResults=$("#search-results"),this.$searchFood=$("#search-food"),this.$help=$("#search-help-text"),this.$dropmenu=$("#search-suggest .dropdown-menu"),this.listenTo(nt.Plugin.Instance,"selected",this.searchFood)},render:function(){return this.$searchResults.html(""),this.$searchResults.append(this.itemTemplate({items:this.collection.toJSON()})),this},toggleHelp:function(){this.$help.toggle()},renderNoResults:function(){var t=this.$searchFood.val(),e='<div class="alert alert-info">Could not find any foods containing: '+t+"</div>";this.$searchResults.html(e)},searchSuccess:function(t,e){0===e.total_hits?this.renderNoResults():this.render()},searchError:function(t,e){var a=e.status,n=e.statusText,i='<div class="alert alert-danger">Nutritionix search request failed with error: <br>'+a+" : "+n+"</div>";this.$searchResults.html(i)},searchFood:function(){var t=this.$searchFood.val().trim(),e={results:"0:10",fields:"item_name,nf_calories,nf_total_fat,nf_total_carbohydrate,nf_protein,nf_serving_size_qty,nf_serving_size_unit",appId:"53242d79",appKey:"82289438a16ec7b92cdcf5ad054159c4"};this.$searchResults.html(nt.preloader),t.length>0?(this.collection.reset(),this.collection.searchPhrase=t,this.collection.fetch({data:$.param(e),success:this.searchSuccess,error:this.searchError})):this.$searchResults.html(""),nt.Router.Instance.navigate("search/"+t)},noSubmit:function(t){t.preventDefault()},clearSearch:function(){this.$searchFood.val(""),this.$searchResults.html(""),nt.Plugin.Instance.hide()}}),nt.Views.Recipe=Backbone.View.extend({el:"#search",recipeTemplate:Handlebars.Templates.recipe,events:{"click #recipe-open":"openRecipes","click #recipe-close":"closeRecipes"},initialize:function(){_.bindAll(this,"recipeSuccess","recipeError"),this.$searchTop=$("#search-top"),this.$searchResults=$("#search-results"),this.$recipeTop=$("#recipe-top"),this.$recipeResults=$("#recipe-results"),this.$recipeResults.html(nt.preloader)},render:function(){return this.$recipeResults.html(""),this.$recipeResults.append(this.recipeTemplate({recipes:this.collection.toJSON()})),this},recipeSuccess:function(t,e){this.render()},recipeError:function(t,e){var a=e.status,n=e.statusText,i='<div class="alert alert-danger">Edamam recipe request failed with error: <br>'+a+" : "+n+"</div>";this.$recipeResults.html(i)},getRecipes:function(t){var e={q:t,app_id:"109142f6",app_key:"21467cc06c5f05e55b19271dcc457914",to:"5"};this.collection.reset(),this.collection.fetch({data:$.param(e),success:this.recipeSuccess,error:this.recipeError})},openRecipes:function(){var t=$("#search-food").val();this.getRecipes(t),this.$searchTop.hide(),this.$searchResults.hide(),this.$recipeTop.show(),this.$recipeResults.show()},closeRecipes:function(){this.$recipeResults.html(""),this.$recipeTop.hide(),this.$searchTop.show(),this.$recipeResults.hide(),this.$searchResults.show()}}),nt.Views.Nutrition=Backbone.View.extend({el:"#app",buttonsTemplate:Handlebars.Templates.buttons,events:{"click .item-nutrition":"openNutrition","click #nutrition-close":"closeNutrition","click #nutrition-add":"addFood","click #nutrition-remove":"removeFood","click #nutrition-track":"openTrackerView"},initialize:function(){_.bindAll(this,"itemSuccess","itemError"),this.$nutrition=$("#nutrition"),this.$nutritionTop=$("#nutrition-top"),this.$nutritionMenu=$("#nutrition-button-menu"),this.$nutritionResults=$("#nutrition-results"),this.$nLabel=$("#nlabel"),this.trackedItem=null,this.gchart=null,this.gformat=null,google.charts.load("current",{packages:["corechart"]}),this.listenTo(nt.Plugin.Instance,"selected",this.closeNutrition),this.listenTo(this.model,"foodsaved",this.updateView)},render:function(){this.displayMenu(),this.displayChart(),this.displayNutrition()},showColumn:function(){this.$nutrition.removeClass("hideColumn")},hideColumn:function(){this.$nutrition.addClass("hideColumn")},openNutrition:function(t){var e=$(t.target),a=e.data("item");t.preventDefault(),this.closeNutrition(),e.closest(".item").css("background-color","#b8dec0").addClass("highlight"),this.showColumn(),this.checkItem(a)},checkItem:function(t){this.trackedItem=nt.Collections.tracker.get(t),this.trackedItem?(this.model.set(this.trackedItem.toJSON()),this.itemSuccess()):this.getNutrition(t)},closeNutrition:function(){$(".highlight").removeAttr("style").removeClass("highlight"),this.$nutritionResults.find("figure").html(""),this.hideColumn(),$(".tracked-delete").show()},itemSuccess:function(t,e){this.render(),$(".row").eqHeights({child:".eqHeights"})},itemError:function(t,e){var a=e.status,n=e.statusText,i='<div class="alert alert-danger">Nutritionix item request failed: <br>'+a+" : "+n+"</div>";this.$nutritionMenu.html(i)},getNutrition:function(t){var e={id:t,appId:"53242d79",appKey:"82289438a16ec7b92cdcf5ad054159c4"};this.$nutritionMenu.html(nt.preloader),this.model.clear(),this.model.fetch({data:$.param(e),success:this.itemSuccess,error:this.itemError})},displayChart:function(){var t=this.model.get("valueTotalFat"),e=this.model.get("valueTotalCarb"),a=this.model.get("valueProteins"),n=google.visualization.arrayToDataTable([["Nutrient","Value"],["Fat",t],["Carbs",e],["Protein",a]]),i={width:280,height:140,backgroundColor:"#b8dec0",sliceVisibilityThreshold:0},r=0!==parseFloat(t+e+a);r&&(this.gformat||(this.gformat=new google.visualization.NumberFormat({suffix:"g"})),this.gchart&&this.gchart.clearChart(),this.gchart=new google.visualization.PieChart(document.getElementById("gchart")),this.gformat.format(n,1),this.gchart.draw(n,i))},displayNutrition:function(){this.$nLabel.html(""),this.$nLabel.undelegate(),this.$nLabel.nutritionLabel(this.model.toJSON())},displayMenu:function(){var t=!1;this.$nutritionMenu.html(""),this.trackedItem&&(t=!0),this.$nutritionMenu.append(this.buttonsTemplate({tracking:t}))},addFood:function(){var t=new nt.Views.Editor({model:this.model});this.$nutrition.append(t.render().renderDatePicker().el)},removeFood:function(){var t=this.model.get("id"),e=nt.Collections.tracker.get(t);e.destroy(),this.trackedItem=null,this.displayMenu()},updateView:function(){var t=this.model.get("id"),e=nt.Collections.tracker.get(t).toJSON();this.model.set(e),this.displayNutrition(),this.trackedItem=!0,this.displayMenu()},openTrackerView:function(){this.closeNutrition(),$("#tab2").trigger("click")}}),nt.Views.Tracker=Backbone.View.extend({el:"#tracker",trackedTemplate:Handlebars.Templates.tracked,emptyMessage:"<p>No foods are being tracked.</p><p>Do a search and add something!</p>",emptyDate:"<p>There are no foods being tracked on this date.</p><p>Select another date or add a food.</p>",events:{"click #dtBack":"dateBack","click #dtForward":"dateForward","click #dtDisplay":"dateDisplay","click .options a":"setOption","click .tracked-delete":"deleteFood","click .tracked-edit":"openFood"},initialize:function(){_.bindAll(this,"sumCals","sumFat","sumCarbs","sumProt"),Handlebars.registerHelper({title:this.title,sumCals:this.sumCals,sumFat:this.sumFat,sumCarbs:this.sumCarbs,sumProt:this.sumProt,show:this.show}),this.$trackerResults=$("#tracker-results"),this.$dtp=$("#dtPicker"),this.listenTo(this.collection,"update",this.render),this.duration=moment.duration({days:1}),this.initDatePicker(),this.collection.fetch()},title:function(t){return nt.Option.displayAll?new Handlebars.SafeString('title="'+t+'"'):void 0},sumCals:function(){return this.collection.calculateSum("valueCalories")},sumFat:function(){return this.collection.calculateSum("valueTotalFat")},sumCarbs:function(){return this.collection.calculateSum("valueTotalCarb")},sumProt:function(){return this.collection.calculateSum("valueProteins")},show:function(t){var e=this.attributes.servingCount,a=0;return e>1?(a=t*e,Number.isInteger(a)?a:Number(a).toFixed(2)):t},render:function(){var t=$("#tracker").hasClass("active");nt.Option.displayAll?(this.renderAll(),t&&nt.Router.Instance.navigate("tracker/all")):(this.renderDate(),t&&nt.Router.Instance.navigate("tracker/date/"+nt.Option.trackerDate))},renderAll:function(){return this.$trackerResults.html(""),this.collection.length?this.$trackerResults.append(this.trackedTemplate(this.collection)):this.$trackerResults.html(this.emptyMessage),this},renderDate:function(){if(this.$trackerResults.html(""),this.collection.length){var t=this.collection.getModelsByDate();t.length?this.$trackerResults.append(this.trackedTemplate(t)):this.$trackerResults.html(this.emptyDate)}else this.$trackerResults.html(this.emptyMessage);return this},initDatePicker:function(){this.$dtp.datetimepicker({format:"MMMM D, YYYY",defaultDate:nt.Option.trackerDate,allowInputToggle:!0});var t=this;$("#dtPicker").on("dp.change",function(e){nt.Option.trackerDate=$(this).data("DateTimePicker").date().format("YYYY-MM-DD"),t.render()})},dateBack:function(){var t=this.$dtp.data("DateTimePicker").date(),e=t.subtract(this.duration);this.$dtp.data("DateTimePicker").date(e)},dateForward:function(){var t=this.$dtp.data("DateTimePicker").date(),e=t.add(this.duration);this.$dtp.data("DateTimePicker").date(e)},dateDisplay:function(){nt.Option.displayAll?($("#optAll").addClass("bold"),$("#optDate").removeClass("bold")):($("#optAll").removeClass("bold"),$("#optDate").addClass("bold"))},setOption:function(t){t.preventDefault();var e=$(t.target).attr("id");"optDate"===e?($("#dtContainer").show(),nt.Option.displayAll=!1):($("#dtContainer").hide(),nt.Option.displayAll=!0),this.render()},deleteFood:function(t){var e=$(t.target).data("id"),a=this.collection.get(e);a.destroy()},openFood:function(t){var e=$(t.target).closest(".tracked-row");nt.Views.nutrition.openNutrition(t),e.css("background-color","#b8dec0").addClass("highlight"),$(".tracked-delete").hide()}}),nt.Views.Editor=Backbone.View.extend({tagName:"div",className:"edit-item",editorTemplate:Handlebars.Templates.editor,count:1,events:{"click #foodSave":"saveFood","click #foodClose":"close","click #servingIncrease":"servingIncrease","click #servingDecrease":"servingDecrease"},initialize:function(){this.createFood().listenTo(this.food,"change",this.updateView)},updateView:function(){var t=$("#dateTimePicker").data("DateTimePicker").date();$("#dateTimePicker").data("DateTimePicker").destroy(),this.render().renderDatePicker(),t&&this.$el.find("#dateTimePicker").data("DateTimePicker").date(t)},render:function(){return this.$el.html(this.editorTemplate(this.food.toJSON())),this},renderDatePicker:function(){return this.$el.find("#dateTimePicker").datetimepicker({format:"YYYY-MM-DD",allowInputToggle:!0,widgetPositioning:{horizontal:"right"}}),this},renderError:function(t){var e='<p class="bs-callout bs-callout-danger alert-danger"><i class="glyphicon glyphicon-exclamation-sign"></i> '+t+"</p>";this.$el.find("#editor-top").append(e)},removeError:function(){this.$el.find(".bs-callout").remove()},getFoodAttributes:function(){return this.model.toJSON()},userAttributes:function(){return{trackDate:this.$el.find("#foodTrackDate").val().trim(),itemName:this.$el.find("#foodName").val().trim(),servingCount:this.count,moreThanOne:this.count>1}},createFood:function(){var t=this.getFoodAttributes();this.food=new nt.Models.Nutrition,this.food.set(t);var e=this.food.get("servingCount");return e>1&&(this.count=e,this.food.valueUpdate(t,e)),this},saveFood:function(t){t.preventDefault(),this.removeError(),this.count>1&&this.food.valueUpdate(this.getFoodAttributes(),1);var e=this.userAttributes();this.food.set(e,{validate:!0});var a=this.food.validationError;a?this.renderError(a):(nt.Collections.tracker.create(this.food,{merge:!0}),this.model.trigger("foodsaved"),this.close())},close:function(){$("#dateTimePicker").data("DateTimePicker").destroy(),this.remove()},servingIncrease:function(){this.count>=1&&this.count++,this.food.valueUpdate(this.getFoodAttributes(),this.count)},servingDecrease:function(){this.count>=2&&this.count--,this.food.valueUpdate(this.getFoodAttributes(),this.count)}}),nt.Router=Backbone.Router.extend({routes:{start:"start",search:"startSearch","search/:query":"search","tracker/:display(/:date)":"tracker"},"goto":function(t){nt.Router.Instance.navigate(t,{trigger:!0})},start:function(){nt.Views.start.showStart()},startSearch:function(){var t=$("#search").hasClass("active");t||$("#tab1").trigger("click"),nt.Views.start.hideStart(),nt.Views.search.$searchFood.val(""),nt.Views.search.$searchResults.html("")},search:function(t){var e=$("#search").hasClass("active");e||$("#tab1").trigger("click"),nt.Views.start.hideStart(),nt.Views.search.$searchFood.val(t),nt.Views.search.searchFood(),nt.Plugin.Instance.hide()},tracker:function(t,e){nt.Views.start.hideStart();var a=$("#tracker").hasClass("active");
if(a||$("#tab2").trigger("click"),"all"===t)$("#dtContainer").hide(),nt.Option.displayAll=!0,nt.Views.tracker.$dtp.data("DateTimePicker").date(moment(new Date));else if("date"===t&&e.length>0){var n=moment(e).format("MMMM D, YYYY");$("#dtContainer").show(),nt.Option.displayAll=!1,nt.Option.trackerDate=e,nt.Views.tracker.$dtp.data("DateTimePicker").date(n)}nt.Views.tracker.dateDisplay()}}),$(document).ready(function(){nt.Router.Instance=new nt.Router,nt.Models.nutrition=new nt.Models.Nutrition,nt.Collections.suggest=new nt.Collections.AutocompleteSearch,nt.Collections.results=new nt.Collections.FoodSearch,nt.Collections.recipes=new nt.Collections.RecipeSearch,nt.Collections.tracker=new nt.Collections.NutritionTracker,nt.Plugin.Typeahead=Backbone.Typeahead.extend({template:Handlebars.Templates.search}),nt.Plugin.Instance=new nt.Plugin.Typeahead({collection:nt.Collections.suggest,key:"text"}),nt.Plugin.Instance.setElement("#search-suggest").render(),nt.Views.start=new nt.Views.Start,nt.Views.tabs=new nt.Views.TabNav,nt.Views.search=new nt.Views.Search({collection:nt.Collections.results}),nt.Views.recipe=new nt.Views.Recipe({collection:nt.Collections.recipes}),nt.Views.nutrition=new nt.Views.Nutrition({model:nt.Models.nutrition}),nt.Views.tracker=new nt.Views.Tracker({collection:nt.Collections.tracker}),Backbone.history.start(),nt.Router.Instance["goto"]("start")});

